@using Niu.Nutri.Shared.Blazor.Forms.RightContainer
@using Niu.Nutri.SystemSettings.Application.DTO.Aggregates.SystemSettingsAgg.Requests;
@using Syncfusion.Blazor.Buttons

<div class="rightcontainer-header-accordeon-empresa" "@(isMyPage ? "active" : "" )">
    @{
        var isMyPage = (Model.ExternalId == RightContext.SubItemId || Model.ExternalId == Model?.ExternalId);
    }

    <div class="titulos-rightcontainer-v2">
        <div class="quebra-linha-titulos-rightcontainer-v2">
            <div class="circle">
                <SfIcon IconCss="bi bi-menu-button-wide-fill"></SfIcon>
            </div>

            <div class="grupo-titulos-rightcontainer-v2">
                <div class="titulo-rightcontainer-v2">
                    @if (!string.IsNullOrEmpty(Model?.H1))
                    {
                        @* @(Model?.H1.Length > 20 ? Model?.H1.Substring(0, 20) + "..." : Model?.H1) *@
                        @(Model?.H1) 
                    }
                </div>
                <div class="subtitulo-rightcontainer-v2">
                    @if (!string.IsNullOrEmpty(Model?.Description))
                    {
                        @(Model?.Description)
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="rightcontainer-etapas-cadastro-btn-add-remover-empresa">

        @if (Model?.Active.HasValue == true)
        {
            if (Model?.IsRegisterDone() == true)
            {
                <div class="rightcontainer-etapa-cadastro-empresa">
                    <SfIcon class="cadastro-completo-empresa" IconCss="bi bi-check-circle-fill"></SfIcon>
                </div>

            }
            else
            {
                <div class="rightcontainer-etapa-cadastro-empresa">
                    <i class="etapa-empresa">@(Model?.CurrentStep + 1)</i>
                </div>
            }

            if (Model.ExternalId == Model.ExternalId || (Model as SystemPanelSubItemDTO)?.SystemPanelSubItemId == Model.Id)
            {
                <div class="rightcontainer-remover-empresa" @onmouseover="()=>{  RightContext.IsMouseHoverTrashBtn = true; }"
             @onmouseout="()=>{ RightContext.IsMouseHoverTrashBtn = false; }">
                    <SfIcon IconCss="bi bi-trash-fill"></SfIcon>
                </div>
            }
        }
    </div>
</div>

@code {
    [Parameter] public Func<Task> OnClick { get; set; }
    [Parameter] public SystemPanelSubItemDTO Model { get; set; }
    [Parameter] public Func<Task> OnCreateSubElementClicked { get; set; }
    [Parameter] public GenericRightContainerContext RightContext { get; set; }

    protected override Task OnInitializedAsync()
    {
        if (!RightContext.GroupRefreshActions.ContainsKey(Model.ExternalId))
            RightContext.GroupRefreshActions.Add(this.Model.ExternalId, this.StateHasChanged);

        return base.OnInitializedAsync();
    }
}
